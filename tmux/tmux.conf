# =============================================================================
# tmux configuration
# =============================================================================

# -----------------------------------------------------------------------------
# General settings
# -----------------------------------------------------------------------------

# Use 256 colors and true color support
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Undercurl support (for vim LSP diagnostics)
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# Increase scrollback buffer
set -g history-limit 50000

# Faster command sequences (reduce escape delay)
set -s escape-time 10

# Enable focus events for vim/neovim
set -g focus-events on

# Start window and pane numbering at 1 (easier to reach on keyboard)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Don't rename windows automatically
set -g allow-rename off

# Enable mouse support (trackpad scroll = copy mode scrollback)
set -g mouse on

# Smoother mouse scrolling (1 line instead of default 5)
bind -T copy-mode-vi WheelUpPane send-keys -X scroll-up
bind -T copy-mode-vi WheelDownPane send-keys -X scroll-down

# -----------------------------------------------------------------------------
# Prefix key
# -----------------------------------------------------------------------------

# Change prefix from C-b to C-a (easier to reach)
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# -----------------------------------------------------------------------------
# Key bindings
# -----------------------------------------------------------------------------

# Reload config with prefix + r
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# Split panes with | and - (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# New window in current path
bind c new-window -c "#{pane_current_path}"

# Pane navigation: Ctrl+hjkl (via vim-tmux-navigator plugin)
# This allows seamless navigation between vim splits and tmux panes

# Switch windows with Shift + arrow keys (no prefix needed)
bind -n S-Left previous-window
bind -n S-Right next-window

# Resize panes with prefix + hjkl (vim keys, repeatable)
bind -r h resize-pane -L 5
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5

# Quick session switching
bind s choose-tree -sZ

# -----------------------------------------------------------------------------
# Status bar
# -----------------------------------------------------------------------------

set -g status-position top
set -g status-interval 5

# Status bar colors
set -g status-style bg=default,fg=white

# Left side: session name
set -g status-left-length 30
set -g status-left "#[fg=green,bold][#S] "

# Right side: date and time
set -g status-right-length 50
set -g status-right "#[fg=cyan]%Y-%m-%d #[fg=white]%H:%M"

# Window status
set -g window-status-format " #I:#W "
set -g window-status-current-format "#[fg=black,bg=green,bold] #I:#W "

# Pane borders
set -g pane-border-style fg=brightblack
set -g pane-active-border-style fg=green

# -----------------------------------------------------------------------------
# Copy mode (vim-style)
# -----------------------------------------------------------------------------

setw -g mode-keys vi

# Enter copy mode with prefix + [
# Start selection with v, copy with y
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# macOS clipboard integration
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# -----------------------------------------------------------------------------
# Sessionizer (ThePrimeagen workflow)
# -----------------------------------------------------------------------------

# Quick project switching with fzf
bind-key -r f run-shell "tmux neww ~/.local/bin/tmux-sessionizer"

# -----------------------------------------------------------------------------
# Plugins (via TPM)
# -----------------------------------------------------------------------------

# Set plugin install path (keep plugins with config)
set-environment -g TMUX_PLUGIN_MANAGER_PATH '~/.config/tmux/plugins'

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Resurrect options
set -g @resurrect-capture-pane-contents 'on'

# Continuum auto-restore
set -g @continuum-restore 'on'

# Initialize TPM (must be at the very end of tmux.conf)
run '~/.config/tmux/plugins/tpm/tpm'
